<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KidsChess - Ø´Ø·Ø±Ù†Ø¬ Ø§Ù„Ø£Ø·ÙØ§Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            grid-column: 1 / -1;
            text-align: center;
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .sidebar {
            background: #f8fafc;
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #e2e8f0;
        }

        .sidebar h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .mode-selector {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            padding: 15px;
            border: 3px solid #667eea;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1em;
            font-weight: bold;
            text-align: center;
        }

        .mode-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
        }

        .piece-guide {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #e2e8f0;
        }

        .piece-guide h3 {
            color: #764ba2;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .piece-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            margin: 5px 0;
            background: #f1f5f9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .piece-item:hover {
            background: #e0e7ff;
            transform: translateX(-5px);
        }

        .piece-icon {
            font-size: 2em;
        }

        .piece-info {
            flex: 1;
        }

        .piece-name {
            font-weight: bold;
            color: #1e293b;
        }

        .piece-desc {
            font-size: 0.9em;
            color: #64748b;
        }

        .main-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .game-info {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 15px;
            color: white;
            font-size: 1.3em;
            font-weight: bold;
        }

        .board-container {
            display: flex;
            justify-content: center;
            position: relative;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 5px solid #8b5cf6;
            border-radius: 10px;
            overflow: hidden;
            max-width: 500px;
            aspect-ratio: 1;
            width: 100%;
        }

        .square {
            aspect-ratio: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(2em, 5vw, 3em);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .square.light {
            background: #f0d9b5;
        }

        .square.dark {
            background: #b58863;
        }

        .square.selected {
            background: #7dd3fc !important;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
            animation: selected-pulse 0.5s ease;
        }

        @keyframes selected-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .square.valid-move {
            background: #86efac !important;
        }

        .square.valid-move::after {
            content: 'â—';
            position: absolute;
            font-size: 0.5em;
            color: #16a34a;
            animation: bounce 0.6s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .square.highlighted {
            box-shadow: inset 0 0 15px rgba(250, 204, 21, 0.8);
            animation: glow 1s infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: inset 0 0 15px rgba(250, 204, 21, 0.8); }
            50% { box-shadow: inset 0 0 25px rgba(250, 204, 21, 1); }
        }

        .square:hover {
            transform: scale(1.05);
            z-index: 10;
        }

        .instruction-panel {
            background: #fef3c7;
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #fbbf24;
            text-align: center;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .instruction-panel h3 {
            color: #92400e;
            margin-bottom: 10px;
            font-size: 1.4em;
        }

        .instruction-panel p {
            color: #78350f;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 25px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .primary-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .secondary-btn {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
        }

        .success-btn {
            background: linear-gradient(135deg, #86efac 0%, #22c55e 100%);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .lesson-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .lesson-item {
            padding: 15px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .lesson-item:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateX(-5px);
        }

        .lesson-item.completed {
            border-color: #22c55e;
            background: #f0fdf4;
        }

        .lesson-number {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .lesson-item.completed .lesson-number {
            background: #22c55e;
        }

        .hint-box {
            background: #dbeafe;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #3b82f6;
            margin-top: 10px;
        }

        .hint-box h4 {
            color: #1e40af;
            margin-bottom: 5px;
        }

        .hint-box p {
            color: #1e3a8a;
            font-size: 1em;
        }

        .score-display {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            padding: 15px;
            border-radius: 10px;
            color: white;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: 2;
            }
            
            .main-area {
                order: 1;
            }
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            text-align: center;
            z-index: 1000;
            animation: celebrationPop 0.5s ease;
        }

        @keyframes celebrationPop {
            0% { transform: translate(-50%, -50%) scale(0); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .celebration h2 {
            color: #22c55e;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>â™Ÿï¸ KidsChess - ØªØ¹Ù„Ù… Ø§Ù„Ø´Ø·Ø±Ù†Ø¬ â™Ÿï¸</h1>

        <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø§Ù„Ø£ÙŠÙ…Ù† -->
        <div class="sidebar">
            <h2>ğŸ¯ Ø§Ø®ØªØ± ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø¹Ø¨</h2>
            <div class="mode-selector">
                <div class="mode-btn active" onclick="setMode('learn')">
                    ğŸ“š ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ù„Ù…
                </div>
                <div class="mode-btn" onclick="setMode('practice')">
                    ğŸ® ÙˆØ¶Ø¹ Ø§Ù„ØªØ¯Ø±ÙŠØ¨
                </div>
                <div class="mode-btn" onclick="setMode('puzzle')">
                    ğŸ§© Ø§Ù„Ø£Ù„ØºØ§Ø²
                </div>
                <div class="mode-btn" onclick="setMode('free')">
                    ğŸ†“ Ù„Ø¹Ø¨ Ø­Ø±
                </div>
            </div>

            <div id="lessons-panel" style="display: block;">
                <h2>ğŸ“– Ø§Ù„Ø¯Ø±ÙˆØ³</h2>
                <div class="lesson-list">
                    <div class="lesson-item" onclick="startLesson(1)">
                        <div class="lesson-number">1</div>
                        <div>ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø·Ø¹</div>
                    </div>
                    <div class="lesson-item" onclick="startLesson(2)">
                        <div class="lesson-number">2</div>
                        <div>ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨ÙŠØ¯Ù‚</div>
                    </div>
                    <div class="lesson-item" onclick="startLesson(3)">
                        <div class="lesson-number">3</div>
                        <div>ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø±Ø®</div>
                    </div>
                    <div class="lesson-item" onclick="startLesson(4)">
                        <div class="lesson-number">4</div>
                        <div>ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø­ØµØ§Ù†</div>
                    </div>
                    <div class="lesson-item" onclick="startLesson(5)">
                        <div class="lesson-number">5</div>
                        <div>ØªØ­Ø±ÙŠÙƒ Ø§Ù„ÙÙŠÙ„</div>
                    </div>
                    <div class="lesson-item" onclick="startLesson(6)">
                        <div class="lesson-number">6</div>
                        <div>ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù…Ù„ÙƒØ©</div>
                    </div>
                    <div class="lesson-item" onclick="startLesson(7)">
                        <div class="lesson-number">7</div>
                        <div>ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù…Ù„Ùƒ</div>
                    </div>
                </div>
            </div>

            <div class="score-display" id="score-display">
                â­ Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span>
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div class="main-area">
            <div class="game-info" id="game-info">
                Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø§Ø®ØªØ± Ø¯Ø±Ø³Ø§Ù‹ Ù„ØªØ¨Ø¯Ø£ Ø§Ù„ØªØ¹Ù„Ù… ğŸ“
            </div>

            <div class="board-container">
                <div class="board" id="board"></div>
            </div>

            <div class="instruction-panel" id="instruction-panel">
                <h3>ğŸ“š ØªØ¹Ù„ÙŠÙ…Ø§Øª</h3>
                <p>Ø§Ø®ØªØ± Ø£Ø­Ø¯ Ø§Ù„Ø¯Ø±ÙˆØ³ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„ØªØ¨Ø¯Ø£ Ø±Ø­Ù„Ø© ØªØ¹Ù„Ù… Ø§Ù„Ø´Ø·Ø±Ù†Ø¬!</p>
            </div>

            <div class="controls">
                <button class="success-btn" id="hint-btn" onclick="showHint()" style="display: none;">
                    ğŸ’¡ ØªÙ„Ù…ÙŠØ­
                </button>
                <button class="secondary-btn" id="next-btn" onclick="nextStep()" style="display: none;">
                    â­ï¸ Ø§Ù„ØªØ§Ù„ÙŠ
                </button>
                <button class="primary-btn" onclick="resetBoard()">
                    ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·
                </button>
            </div>
        </div>

        <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø§Ù„Ø£ÙŠØ³Ø± -->
        <div class="sidebar">
            <h2>ğŸ“– Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù‚Ø·Ø¹</h2>
            <div class="piece-guide">
                <div class="piece-item" onclick="showPieceInfo('pawn')">
                    <div class="piece-icon">â™™</div>
                    <div class="piece-info">
                        <div class="piece-name">Ø§Ù„Ø¨ÙŠØ¯Ù‚</div>
                        <div class="piece-desc">ÙŠØªØ­Ø±Ùƒ Ù„Ù„Ø£Ù…Ø§Ù… ÙÙ‚Ø·</div>
                    </div>
                </div>
                <div class="piece-item" onclick="showPieceInfo('rook')">
                    <div class="piece-icon">â™–</div>
                    <div class="piece-info">
                        <div class="piece-name">Ø§Ù„Ø±Ø® (Ø§Ù„Ù‚Ù„Ø¹Ø©)</div>
                        <div class="piece-desc">Ø£ÙÙ‚ÙŠ ÙˆØ¹Ù…ÙˆØ¯ÙŠ</div>
                    </div>
                </div>
                <div class="piece-item" onclick="showPieceInfo('knight')">
                    <div class="piece-icon">â™˜</div>
                    <div class="piece-info">
                        <div class="piece-name">Ø§Ù„Ø­ØµØ§Ù†</div>
                        <div class="piece-desc">Ø­Ø±Ù L</div>
                    </div>
                </div>
                <div class="piece-item" onclick="showPieceInfo('bishop')">
                    <div class="piece-icon">â™—</div>
                    <div class="piece-info">
                        <div class="piece-name">Ø§Ù„ÙÙŠÙ„</div>
                        <div class="piece-desc">Ù‚Ø·Ø±ÙŠØ§Ù‹ ÙÙ‚Ø·</div>
                    </div>
                </div>
                <div class="piece-item" onclick="showPieceInfo('queen')">
                    <div class="piece-icon">â™•</div>
                    <div class="piece-info">
                        <div class="piece-name">Ø§Ù„Ù…Ù„ÙƒØ© (Ø§Ù„ÙˆØ²ÙŠØ±)</div>
                        <div class="piece-desc">Ø£Ù‚ÙˆÙ‰ Ù‚Ø·Ø¹Ø©</div>
                    </div>
                </div>
                <div class="piece-item" onclick="showPieceInfo('king')">
                    <div class="piece-icon">â™”</div>
                    <div class="piece-info">
                        <div class="piece-name">Ø§Ù„Ù…Ù„Ùƒ</div>
                        <div class="piece-desc">Ù…Ø±Ø¨Ø¹ ÙˆØ§Ø­Ø¯</div>
                    </div>
                </div>
            </div>

            <div id="hint-box" class="hint-box" style="display: none;">
                <h4>ğŸ’¡ ØªÙ„Ù…ÙŠØ­</h4>
                <p id="hint-text"></p>
            </div>
        </div>
    </div>

    <script>
        const pieces = {
            'K': 'â™”', 'Q': 'â™•', 'R': 'â™–', 'B': 'â™—', 'N': 'â™˜', 'P': 'â™™',
            'k': 'â™š', 'q': 'â™›', 'r': 'â™œ', 'b': 'â™', 'n': 'â™', 'p': 'â™Ÿ'
        };

        const pieceNames = {
            'P': 'Ø§Ù„Ø¨ÙŠØ¯Ù‚ Ø§Ù„Ø£Ø¨ÙŠØ¶', 'p': 'Ø§Ù„Ø¨ÙŠØ¯Ù‚ Ø§Ù„Ø£Ø³ÙˆØ¯',
            'R': 'Ø§Ù„Ø±Ø® Ø§Ù„Ø£Ø¨ÙŠØ¶', 'r': 'Ø§Ù„Ø±Ø® Ø§Ù„Ø£Ø³ÙˆØ¯',
            'N': 'Ø§Ù„Ø­ØµØ§Ù† Ø§Ù„Ø£Ø¨ÙŠØ¶', 'n': 'Ø§Ù„Ø­ØµØ§Ù† Ø§Ù„Ø£Ø³ÙˆØ¯',
            'B': 'Ø§Ù„ÙÙŠÙ„ Ø§Ù„Ø£Ø¨ÙŠØ¶', 'b': 'Ø§Ù„ÙÙŠÙ„ Ø§Ù„Ø£Ø³ÙˆØ¯',
            'Q': 'Ø§Ù„Ù…Ù„ÙƒØ© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡', 'q': 'Ø§Ù„Ù…Ù„ÙƒØ© Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡',
            'K': 'Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø£Ø¨ÙŠØ¶', 'k': 'Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø£Ø³ÙˆØ¯'
        };

        let board = [];
        let selectedSquare = null;
        let currentMode = 'learn';
        let currentLesson = null;
        let lessonStep = 0;
        let score = 0;
        let expectedMove = null;

        const lessons = {
            1: {
                title: 'ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø·Ø¹',
                steps: [
                    {
                        board: [
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['P', 'R', 'N', 'B', 'Q', 'K', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', '']
                        ],
                        instruction: 'Ù‡Ø°Ù‡ Ù‡ÙŠ Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ ÙÙŠ Ø§Ù„Ø´Ø·Ø±Ù†Ø¬! Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ†: Ø§Ù„Ø¨ÙŠØ¯Ù‚ØŒ Ø§Ù„Ø±Ø®ØŒ Ø§Ù„Ø­ØµØ§Ù†ØŒ Ø§Ù„ÙÙŠÙ„ØŒ Ø§Ù„Ù…Ù„ÙƒØ©ØŒ ÙˆØ§Ù„Ù…Ù„Ùƒ',
                        highlight: [[3,0], [3,1], [3,2], [3,3], [3,4], [3,5]]
                    }
                ]
            },
            2: {
                title: 'ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨ÙŠØ¯Ù‚',
                steps: [
                    {
                        board: [
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', 'P', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', '']
                        ],
                        instruction: 'Ø§Ù„Ø¨ÙŠØ¯Ù‚ ÙŠØªØ­Ø±Ùƒ Ù„Ù„Ø£Ù…Ø§Ù… Ù…Ø±Ø¨Ø¹ ÙˆØ§Ø­Ø¯. Ø¬Ø±Ø¨ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨ÙŠØ¯Ù‚ Ù„Ù„Ø£Ù…Ø§Ù…!',
                        highlight: [[4,3]],
                        expectedFrom: [4,3],
                        expectedTo: [3,3]
                    },
                    {
                        board: [
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', 'P', '', '', '', ''],
                            ['', '', '', '', '', '', '', '']
                        ],
                        instruction: 'ÙÙŠ Ø£ÙˆÙ„ Ø­Ø±ÙƒØ©ØŒ Ø§Ù„Ø¨ÙŠØ¯Ù‚ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„ØªØ­Ø±Ùƒ Ù…Ø±Ø¨Ø¹ÙŠÙ†! Ø¬Ø±Ø¨ ØªØ­Ø±ÙŠÙƒÙ‡ Ù…Ø±Ø¨Ø¹ÙŠÙ† Ù„Ù„Ø£Ù…Ø§Ù…',
                        highlight: [[6,3]],
                        expectedFrom: [6,3],
                        expectedTo: [4,3]
                    }
                ]
            },
            3: {
                title: 'ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø±Ø®',
                steps: [
                    {
                        board: [
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', 'R', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', '']
                        ],
                        instruction: 'Ø§Ù„Ø±Ø® ÙŠØªØ­Ø±Ùƒ Ø£ÙÙ‚ÙŠØ§Ù‹ Ø£Ùˆ Ø¹Ù…ÙˆØ¯ÙŠØ§Ù‹! Ø¬Ø±Ø¨ ØªØ­Ø±ÙŠÙƒÙ‡ ÙŠÙ…ÙŠÙ†Ø§Ù‹',
                        highlight: [[3,3]],
                        expectedFrom: [3,3],
                        expectedTo: [3,6]
                    }
                ]
            },
            4: {
                title: 'ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø­ØµØ§Ù†',
                steps: [
                    {
                        board: [
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', 'N', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', '']
                        ],
                        instruction: 'Ø§Ù„Ø­ØµØ§Ù† ÙŠØªØ­Ø±Ùƒ Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ø­Ø±Ù L! Ù…Ø±Ø¨Ø¹ÙŠÙ† ÙÙŠ Ø§ØªØ¬Ø§Ù‡ ÙˆÙ…Ø±Ø¨Ø¹ ÙÙŠ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ. Ø¬Ø±Ø¨!',
                        highlight: [[3,3]],
                        expectedFrom: [3,3],
                        expectedTo: [1,4]
                    }
                ]
            },
            5: {
                title: 'ØªØ­Ø±ÙŠÙƒ Ø§Ù„ÙÙŠÙ„',
                steps: [
                    {
                        board: [
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', 'B', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', '']
                        ],
                        instruction: 'Ø§Ù„ÙÙŠÙ„ ÙŠØªØ­Ø±Ùƒ Ù‚Ø·Ø±ÙŠØ§Ù‹ ÙÙ‚Ø·! Ø¬Ø±Ø¨ ØªØ­Ø±ÙŠÙƒÙ‡ Ø¨Ø´ÙƒÙ„ Ù‚Ø·Ø±ÙŠ',
                        highlight: [[3,3]],
                        expectedFrom: [3,3],
                        expectedTo: [0,6]
                    }
                ]
            },
            6: {
                title: 'ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù…Ù„ÙƒØ©',
                steps: [
                    {
                        board: [
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', 'Q', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', '']
                        ],
                        instruction: 'Ø§Ù„Ù…Ù„ÙƒØ© Ø£Ù‚ÙˆÙ‰ Ù‚Ø·Ø¹Ø©! ØªØªØ­Ø±Ùƒ Ø£ÙÙ‚ÙŠØ§Ù‹ØŒ Ø¹Ù…ÙˆØ¯ÙŠØ§Ù‹ØŒ ÙˆÙ‚Ø·Ø±ÙŠØ§Ù‹. Ø¬Ø±Ø¨ ØªØ­Ø±ÙŠÙƒÙ‡Ø§!',
                        highlight: [[3,3]],
                        expectedFrom: [3,3],
                        expectedTo: [3,7]
                    }
                ]
            },
            7: {
                title: 'ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù…Ù„Ùƒ',
                steps: [
                    {
                        board: [
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', 'K', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', ''],
                            ['', '', '', '', '', '', '', '']
                        ],
                        instruction: 'Ø§Ù„Ù…Ù„Ùƒ ÙŠØªØ­Ø±Ùƒ Ù…Ø±Ø¨Ø¹ ÙˆØ§Ø­Ø¯ ÙÙŠ Ø£ÙŠ Ø§ØªØ¬Ø§Ù‡. Ø¬Ø±Ø¨ ØªØ­Ø±ÙŠÙƒÙ‡!',
                        highlight: [[3,3]],
                        expectedFrom: [3,3],
                        expectedTo: [2,3]
                    }
                ]
            }
        };

        function initGame() {
            board = Array(8).fill().map(() => Array(8).fill(''));
            renderBoard();
        }

        function renderBoard() {
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = '';

            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.className = 'square';
                    square.className += (row + col) % 2 === 0 ? ' light' : ' dark';
                    square.dataset.row = row;
                    square.dataset.col = col;
                    
                    const piece = board[row][col];
                    if (piece) {
                        square.textContent = pieces[piece];
                    }

                    square.addEventListener('click', () => handleSquareClick(row, col));
                    boardElement.appendChild(square);
                }
            }

            updateScore();
        }

        function handleSquareClick(row, col) {
            const piece = board[row][col];

            if (currentMode === 'learn' && currentLesson) {
                handleLessonClick(row, col);
                return;
            }

            if (selectedSquare) {
                if (isValidMove(selectedSquare.row, selectedSquare.col, row, col)) {
                    makeMove(selectedSquare.row, selectedSquare.col, row, col);
                    selectedSquare = null;
                    renderBoard();
                    playSound('move');
                } else {
                    selectedSquare = null;
                    renderBoard();
                }
            } else {
                if (piece) {
                    selectedSquare = {row, col};
                    highlightValidMoves(row, col);
                    showPieceMoveDescription(piece);
                }
            }
        }

        function handleLessonClick(row, col) {
            const step = lessons[currentLesson].steps[lessonStep];
            
            if (!step.expectedFrom) {
                return;
            }

            if (!selectedSquare) {
                if (row === step.expectedFrom[0] && col === step.expectedFrom[1]) {
                    selectedSquare = {row, col};
                    highlightValidMoves(row, col);
                    document.getElementById('instruction-panel').innerHTML = `
                        <h3>âœ… ØµØ­ÙŠØ­!</h3>
                        <p>Ø§Ù„Ø¢Ù† Ø­Ø±Ù‘Ùƒ Ø§Ù„Ù‚Ø·Ø¹Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØµØ­ÙŠØ­ Ø§Ù„Ù…ÙØ¸Ù„Ù„ Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø®Ø¶Ø±</p>
                    `;
                } else {
                    document.getElementById('instruction-panel').innerHTML = `
                        <h3>âŒ Ø®Ø·Ø£</h3>
                        <p>Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„Ù…ÙØ¸Ù„Ù„Ø© Ø¨Ø§Ù„Ø£ØµÙØ± Ø£ÙˆÙ„Ø§Ù‹!</p>
                    `;
                    playSound('error');
                }
            } else {
                if (row === step.expectedTo[0] && col === step.expectedTo[1]) {
                    makeMove(selectedSquare.row, selectedSquare.col, row, col);
                    selectedSquare = null;
                    score += 10;
                    playSound('success');
                    showCelebration('ğŸ‰ Ø£Ø­Ø³Ù†Øª! +10 Ù†Ù‚Ø§Ø·');
                    
                    setTimeout(() => {
                        lessonStep++;
                        if (lessonStep < lessons[currentLesson].steps.length) {
                            loadLessonStep();
                        } else {
                            completedLesson();
                        }
                    }, 2000);
                } else {
                    selectedSquare = null;
                    renderBoard();
                    loadLessonStep();
                    document.getElementById('instruction-panel').innerHTML = `
                        <h3>âŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</h3>
                        <p>Ù‡Ø°Ù‡ Ù„ÙŠØ³Øª Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„ØµØ­ÙŠØ­Ø©. Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!</p>
                    `;
                    playSound('error');
                }
            }
        }

        function isValidMove(fromRow, fromCol, toRow, toCol) {
            if (fromRow === toRow && fromCol === toCol) return false;
            const piece = board[fromRow][fromCol];
            if (!piece) return false;

            const rowDiff = toRow - fromRow;
            const colDiff = toCol - fromCol;
            const pieceType = piece.toLowerCase();

            switch(pieceType) {
                case 'p':
                    const direction = piece === piece.toUpperCase() ? -1 : 1;
                    return (colDiff === 0 && rowDiff === direction && !board[toRow][toCol]);
                case 'r':
                    return (rowDiff === 0 || colDiff === 0) && isPathClear(fromRow, fromCol, toRow, toCol);
                case 'n':
                    return (Math.abs(rowDiff) === 2 && Math.abs(colDiff) === 1) || 
                           (Math.abs(rowDiff) === 1 && Math.abs(colDiff) === 2);
                case 'b':
                    return Math.abs(rowDiff) === Math.abs(colDiff) && isPathClear(fromRow, fromCol, toRow, toCol);
                case 'q':
                    return (rowDiff === 0 || colDiff === 0 || Math.abs(rowDiff) === Math.abs(colDiff)) && 
                           isPathClear(fromRow, fromCol, toRow, toCol);
                case 'k':
                    return Math.abs(rowDiff) <= 1 && Math.abs(colDiff) <= 1;
                default:
                    return false;
            }
        }

        function isPathClear(fromRow, fromCol, toRow, toCol) {
            const rowStep = toRow > fromRow ? 1 : (toRow < fromRow ? -1 : 0);
            const colStep = toCol > fromCol ? 1 : (toCol < fromCol ? -1 : 0);
            let currentRow = fromRow + rowStep;
            let currentCol = fromCol + colStep;

            while (currentRow !== toRow || currentCol !== toCol) {
                if (board[currentRow][currentCol]) return false;
                currentRow += rowStep;
                currentCol += colStep;
            }
            return true;
        }

        function highlightValidMoves(row, col) {
            renderBoard();
            const squares = document.querySelectorAll('.square');
            squares[row * 8 + col].classList.add('selected');

            for (let r = 0; r < 8; r++) {
                for (let c = 0; c < 8; c++) {
                    if (isValidMove(row, col, r, c)) {
                        squares[r * 8 + c].classList.add('valid-move');
                    }
                }
            }
        }

        function makeMove(fromRow, fromCol, toRow, toCol) {
            board[toRow][toCol] = board[fromRow][fromCol];
            board[fromRow][fromCol] = '';
        }

        function showPieceMoveDescription(piece) {
            const descriptions = {
                'P': 'Ø§Ù„Ø¨ÙŠØ¯Ù‚ Ø§Ù„Ø£Ø¨ÙŠØ¶: ÙŠØªØ­Ø±Ùƒ Ù…Ø±Ø¨Ø¹ ÙˆØ§Ø­Ø¯ Ù„Ù„Ø£Ù…Ø§Ù…ØŒ ÙˆÙ…Ø±Ø¨Ø¹ÙŠÙ† ÙÙŠ Ø£ÙˆÙ„ Ø­Ø±ÙƒØ©',
                'R': 'Ø§Ù„Ø±Ø® Ø§Ù„Ø£Ø¨ÙŠØ¶: ÙŠØªØ­Ø±Ùƒ Ø£ÙÙ‚ÙŠØ§Ù‹ Ø£Ùˆ Ø¹Ù…ÙˆØ¯ÙŠØ§Ù‹ Ø£ÙŠ Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª',
                'N': 'Ø§Ù„Ø­ØµØ§Ù† Ø§Ù„Ø£Ø¨ÙŠØ¶: ÙŠØªØ­Ø±Ùƒ Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ø­Ø±Ù L (Ù…Ø±Ø¨Ø¹ÙŠÙ† ÙÙŠ Ø§ØªØ¬Ø§Ù‡ ÙˆÙ…Ø±Ø¨Ø¹ Ø¹Ù…ÙˆØ¯ÙŠ)',
                'B': 'Ø§Ù„ÙÙŠÙ„ Ø§Ù„Ø£Ø¨ÙŠØ¶: ÙŠØªØ­Ø±Ùƒ Ù‚Ø·Ø±ÙŠØ§Ù‹ Ø£ÙŠ Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª',
                'Q': 'Ø§Ù„Ù…Ù„ÙƒØ© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡: Ø£Ù‚ÙˆÙ‰ Ù‚Ø·Ø¹Ø©! ØªØªØ­Ø±Ùƒ Ø£ÙÙ‚ÙŠØ§Ù‹ ÙˆØ¹Ù…ÙˆØ¯ÙŠØ§Ù‹ ÙˆÙ‚Ø·Ø±ÙŠØ§Ù‹',
                'K': 'Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø£Ø¨ÙŠØ¶: ÙŠØªØ­Ø±Ùƒ Ù…Ø±Ø¨Ø¹ ÙˆØ§Ø­Ø¯ ÙÙŠ Ø£ÙŠ Ø§ØªØ¬Ø§Ù‡'
            };

            if (descriptions[piece]) {
                document.getElementById('game-info').textContent = descriptions[piece];
            }
        }

        function startLesson(lessonNum) {
            currentLesson = lessonNum;
            lessonStep = 0;
            currentMode = 'learn';
            
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.mode-btn')[0].classList.add('active');
            
            loadLessonStep();
        }

        function loadLessonStep() {
            const lesson = lessons[currentLesson];
            const step = lesson.steps[lessonStep];
            
            board = step.board.map(row => [...row]);
            renderBoard();
            
            document.getElementById('game-info').textContent = `${lesson.title} - Ø§Ù„Ø®Ø·ÙˆØ© ${lessonStep + 1}`;
            document.getElementById('instruction-panel').innerHTML = `
                <h3>ğŸ“š Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª</h3>
                <p>${step.instruction}</p>
            `;

            if (step.highlight) {
                setTimeout(() => {
                    const squares = document.querySelectorAll('.square');
                    step.highlight.forEach(([r, c]) => {
                        squares[r * 8 + c].classList.add('highlighted');
                    });
                }, 100);
            }
        }

        function completedLesson() {
            document.getElementById('instruction-panel').innerHTML = `
                <h3>ğŸŠ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!</h3>
                <p>Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ø¯Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ø®ØªØ± Ø¯Ø±Ø³Ø§Ù‹ Ø¢Ø®Ø± Ù„ØªØªØ¹Ù„Ù… Ø§Ù„Ù…Ø²ÙŠØ¯</p>
            `;
            
            const lessonItems = document.querySelectorAll('.lesson-item');
            lessonItems[currentLesson - 1].classList.add('completed');
            
            playSound('complete');
        }

        function setMode(mode) {
            currentMode = mode;
            const btns = document.querySelectorAll('.mode-btn');
            btns.forEach(btn => btn.classList.remove('active'));
            
            if (mode === 'learn') {
                btns[0].classList.add('active');
                document.getElementById('game-info').textContent = 'Ø§Ø®ØªØ± Ø¯Ø±Ø³Ø§Ù‹ Ù„ØªØ¨Ø¯Ø£ Ø§Ù„ØªØ¹Ù„Ù… ğŸ“';
            } else if (mode === 'practice') {
                btns[1].classList.add('active');
                initPracticeMode();
            } else if (mode === 'puzzle') {
                btns[2].classList.add('active');
                initPuzzleMode();
            } else {
                btns[3].classList.add('active');
                initFreeMode();
            }
        }

        function initPracticeMode() {
            // ÙˆØ¶Ø¹ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ - Ù‚Ø·Ø¹Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù„Ù„ØªØ¯Ø±Ø¨ Ø¹Ù„ÙŠÙ‡Ø§
            const pieces = ['P', 'R', 'N', 'B', 'Q', 'K'];
            const randomPiece = pieces[Math.floor(Math.random() * pieces.length)];
            
            board = Array(8).fill().map(() => Array(8).fill(''));
            board[4][4] = randomPiece;
            renderBoard();
            
            document.getElementById('game-info').textContent = `ØªØ¯Ø±Ø¨ Ø¹Ù„Ù‰ ØªØ­Ø±ÙŠÙƒ ${pieceNames[randomPiece]}`;
            document.getElementById('instruction-panel').innerHTML = `
                <h3>ğŸ® ÙˆØ¶Ø¹ Ø§Ù„ØªØ¯Ø±ÙŠØ¨</h3>
                <p>Ø­Ø±Ùƒ Ø§Ù„Ù‚Ø·Ø¹Ø© ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ ÙˆØ´Ø§Ù‡Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ù…ÙƒÙ†Ø©!</p>
            `;
        }

        function initPuzzleMode() {
            document.getElementById('game-info').textContent = 'ğŸ§© Ø§Ù„Ø£Ù„ØºØ§Ø² Ù‚Ø±ÙŠØ¨Ø§Ù‹!';
            document.getElementById('instruction-panel').innerHTML = `
                <h3>ğŸ§© Ù‚Ø±ÙŠØ¨Ø§Ù‹</h3>
                <p>Ø³Ù†Ø¶ÙŠÙ Ø£Ù„ØºØ§Ø² Ø´Ø·Ø±Ù†Ø¬ Ù…Ù…ØªØ¹Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹!</p>
            `;
        }

        function initFreeMode() {
            board = [
                ['r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'],
                ['p', 'p', 'p', 'p', 'p', 'p', 'p', 'p'],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', ''],
                ['P', 'P', 'P', 'P', 'P', 'P', 'P', 'P'],
                ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R']
            ];
            renderBoard();
            document.getElementById('game-info').textContent = 'ğŸ†“ Ø§Ù„Ø¹Ø¨ Ø¨Ø­Ø±ÙŠØ©!';
            document.getElementById('instruction-panel').innerHTML = `
                <h3>ğŸ†“ Ù„Ø¹Ø¨ Ø­Ø±</h3>
                <p>Ø§Ù„Ø¹Ø¨ Ø¨Ø­Ø±ÙŠØ© ÙˆØ¬Ø±Ø¨ ØªØ­Ø±ÙŠÙƒ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø·Ø¹!</p>
            `;
        }

        function resetBoard() {
            if (currentLesson) {
                loadLessonStep();
            } else if (currentMode === 'free') {
                initFreeMode();
            } else if (currentMode === 'practice') {
                initPracticeMode();
            } else {
                initGame();
            }
        }

        function showPieceInfo(type) {
            const info = {
                'pawn': 'Ø§Ù„Ø¨ÙŠØ¯Ù‚: ÙŠØªØ­Ø±Ùƒ Ù„Ù„Ø£Ù…Ø§Ù… Ù…Ø±Ø¨Ø¹ ÙˆØ§Ø­Ø¯ (Ø£Ùˆ Ù…Ø±Ø¨Ø¹ÙŠÙ† ÙÙŠ Ø£ÙˆÙ„ Ø­Ø±ÙƒØ©). ÙŠØ£ÙƒÙ„ Ù‚Ø·Ø±ÙŠØ§Ù‹.',
                'rook': 'Ø§Ù„Ø±Ø®: ÙŠØªØ­Ø±Ùƒ Ø£ÙÙ‚ÙŠØ§Ù‹ Ø£Ùˆ Ø¹Ù…ÙˆØ¯ÙŠØ§Ù‹ Ø£ÙŠ Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª.',
                'knight': 'Ø§Ù„Ø­ØµØ§Ù†: ÙŠØªØ­Ø±Ùƒ Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ø­Ø±Ù L. Ù…Ø±Ø¨Ø¹ÙŠÙ† ÙÙŠ Ø§ØªØ¬Ø§Ù‡ ÙˆÙ…Ø±Ø¨Ø¹ Ø¹Ù…ÙˆØ¯ÙŠØ§Ù‹. ÙŠÙ‚ÙØ² ÙÙˆÙ‚ Ø§Ù„Ù‚Ø·Ø¹.',
                'bishop': 'Ø§Ù„ÙÙŠÙ„: ÙŠØªØ­Ø±Ùƒ Ù‚Ø·Ø±ÙŠØ§Ù‹ Ø£ÙŠ Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª.',
                'queen': 'Ø§Ù„Ù…Ù„ÙƒØ©: Ø£Ù‚ÙˆÙ‰ Ù‚Ø·Ø¹Ø©! ØªØªØ­Ø±Ùƒ Ø£ÙÙ‚ÙŠØ§Ù‹ ÙˆØ¹Ù…ÙˆØ¯ÙŠØ§Ù‹ ÙˆÙ‚Ø·Ø±ÙŠØ§Ù‹ Ø£ÙŠ Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª.',
                'king': 'Ø§Ù„Ù…Ù„Ùƒ: ÙŠØªØ­Ø±Ùƒ Ù…Ø±Ø¨Ø¹ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· ÙÙŠ Ø£ÙŠ Ø§ØªØ¬Ø§Ù‡. Ø£Ù‡Ù… Ù‚Ø·Ø¹Ø© ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©!'
            };

            document.getElementById('hint-box').style.display = 'block';
            document.getElementById('hint-text').textContent = info[type];
        }

        function showHint() {
            const hints = [
                'Ø­Ø§ÙˆÙ„ Ø­Ù…Ø§ÙŠØ© Ù‚Ø·Ø¹Ùƒ Ø§Ù„Ù…Ù‡Ù…Ø©!',
                'Ø§Ù„Ù…Ù„ÙƒØ© Ø£Ù‚ÙˆÙ‰ Ù‚Ø·Ø¹Ø© - Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¨Ø­ÙƒÙ…Ø©',
                'Ù„Ø§ ØªÙ†Ø³Ù‰ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨ÙŠØ§Ø¯Ù‚ Ù„Ù„Ø£Ù…Ø§Ù…',
                'Ø§Ù„Ø­ØµØ§Ù† ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„Ù‚ÙØ² ÙÙˆÙ‚ Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ø£Ø®Ø±Ù‰'
            ];
            const randomHint = hints[Math.floor(Math.random() * hints.length)];
            
            document.getElementById('hint-box').style.display = 'block';
            document.getElementById('hint-text').textContent = randomHint;
        }

        function showCelebration(message) {
            const overlay = document.createElement('div');
            overlay.className = 'overlay';
            overlay.onclick = () => {
                document.body.removeChild(overlay);
                document.body.removeChild(celebration);
            };
            
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            celebration.innerHTML = `
                <h2>${message}</h2>
                <button class="success-btn" onclick="this.parentElement.parentElement.remove(); this.parentElement.remove();">
                    âœ¨ Ù…ØªØ§Ø¨Ø¹Ø©
                </button>
            `;
            
            document.body.appendChild(overlay);
            document.body.appendChild(celebration);
        }

        function updateScore() {
            document.getElementById('score').textContent = score;
        }

        function playSound(type) {
            // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø£ØµÙˆØ§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù„Ø§Ø­Ù‚Ø§Ù‹
            console.log(`Sound: ${type}`);
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        initGame();
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"9a4021236e7f5945","serverTiming":{"name":{"cfL4":true}},"version":"2025.9.1","token":"4edd5f8ec12a48cfa682ab8261b80a79"}' crossorigin="anonymous"></script>

<!-- BEGIN: BILINGUAL TTS CONTROLS (injected) -->
<style>
#bilingualControls{
  position: fixed;
  left: 12px;
  top: 12px;
  z-index: 9999;
  display:flex;
  gap:8px;
  align-items:center;
  background: rgba(255,255,255,0.85);
  padding:8px 10px;
  border-radius:10px;
  box-shadow:0 6px 18px rgba(0,0,0,0.25);
  font-family: Arial, sans-serif;
  direction: ltr;
}
#bilingualControls button{padding:6px 10px;border-radius:6px;border:1px solid #888;background:#fff;cursor:pointer}
#bilingualControls button.active{background:#667eea;color:#fff;border-color:#667eea}
#bilingualNotice{font-size:12px;color:#333;margin-left:6px}
.lang-indicator{font-weight:600}
</style>

<div id="bilingualControls" aria-hidden="false">
  <div>
    <button id="btnArabic">Ø¹Ø±Ø¨ÙŠ (Ù…ØµØ±ÙŠ)</button>
    <button id="btnEnglish">English (US)</button>
  </div>
  <div>
    <button id="btnSpeakSelected" title="Speak selected text or clicked element">ğŸ”Š Speak</button>
    <button id="btnAutoNarrate" title="Narrate a short tutorial">â–¶ï¸ Tutorial</button>
  </div>
  <div id="bilingualNotice">Language: <span id="currentLang" class="lang-indicator">AR</span></div>
</div>

<script>
(function(){
  // Basic bilingual TTS helper injected into the existing page.
  const btnAr = document.getElementById('btnArabic');
  const btnEn = document.getElementById('btnEnglish');
  const btnSpeak = document.getElementById('btnSpeakSelected');
  const btnAuto = document.getElementById('btnAutoNarrate');
  const cur = document.getElementById('currentLang');
  let lang = 'ar'; // 'ar' or 'en'
  const synth = window.speechSynthesis;

  function setActive(){
    if(lang==='ar'){
      btnAr.classList.add('active');
      btnEn.classList.remove('active');
      cur.innerText = 'AR';
    } else {
      btnEn.classList.add('active');
      btnAr.classList.remove('active');
      cur.innerText = 'EN';
    }
  }

  btnAr.addEventListener('click', ()=>{ lang='ar'; setActive(); });
  btnEn.addEventListener('click', ()=>{ lang='en'; setActive(); });
  setActive();

  // function to speak given text with appropriate lang/voice
  function speak(text){
    if(!text) return;
    if(synth.speaking) synth.cancel();
    const utter = new SpeechSynthesisUtterance(text);
    // prefer specific voice locales but allow browser to choose fallback
    utter.lang = lang==='ar' ? 'ar-EG' : 'en-US';
    // voice selection: try to pick matching voice for locale
    const voices = synth.getVoices();
    if(voices && voices.length){
      const prefer = voices.find(v=> v.lang.toLowerCase().includes(utter.lang.toLowerCase()));
      if(prefer) utter.voice = prefer;
    }
    // friendly rate for children
    utter.rate = 0.95;
    utter.pitch = lang==='ar' ? 1.0 : 1.05;
    synth.speak(utter);
  }

  // Speak selected text or last clicked element's text
  btnSpeak.addEventListener('click', ()=>{
    const sel = window.getSelection().toString().trim();
    if(sel){ speak(sel); return; }
    // fallback: if user previously clicked an element, we remember it
    if(window.__lastClickedText){ speak(window.__lastClickedText); return; }
    speak(lang==='ar' ? 'Ø§Ø®ØªØ± Ù†ØµÙ‹Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø¹Ù†ØµØ± Ù„ØªØ³Ù…Ø¹Ù‡' : 'Select text or click an element to hear it');
  });

  // Add click-to-speak: clicking any visible element will speak its innerText (short)
  document.addEventListener('click', (e)=>{
    // ignore clicks on our controls
    if(e.target.closest && e.target.closest('#bilingualControls')) return;
    let el = e.target;
    // prefer elements with data-narration attribute (if provided by the game)
    let text = el.dataset && el.dataset.narration ? el.dataset.narration
             : (el.innerText || el.textContent || '').trim();
    if(!text) return;
    // shorten long texts for clickable narration
    text = text.split('\\n').map(s=>s.trim()).filter(Boolean).slice(0,3).join('. ');
    // store for speak button fallback
    window.__lastClickedText = text;
    // speak in both languages if tutorial mode is on? For normal click, speak in current language
    speak(text);
  }, true);

  // Tutorial script: educational bilingual phrases for common chess concepts.
  const tutorialSteps = [
    {ar: 'Ù‡Ø°Ù‡ Ù„Ø¹Ø¨Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„Ù„Ø´Ø·Ø±Ù†Ø¬ Ù„Ù„Ø£Ø·ÙØ§Ù„. Ø³Ù†Ø¨Ø¯Ø£ Ø¨Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„Ù‚Ø·Ø¹.', en: 'This is a children\'s educational chess game. We will start with piece basics.'},
    {ar: 'Ø§Ù„Ø¨ÙŠØ¯Ù‚ ÙŠØªØ­Ø±Ùƒ Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù…Ø§Ù…. ÙÙŠ Ø£ÙˆÙ„ Ø­Ø±ÙƒØ© ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„ØªØ­Ø±Ùƒ Ø®Ø·ÙˆØªÙŠÙ†.', en: 'The pawn moves one square forward. On its first move it can move two squares.'},
    {ar: 'Ø§Ù„Ù‚Ù„Ø¹Ø© ØªØªØ­Ø±Ùƒ ÙÙŠ Ø®Ø·ÙˆØ· Ù…Ø³ØªÙ‚ÙŠÙ…Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù…Ø§Ù… Ø£Ùˆ Ø§Ù„Ø®Ù„Ù Ø£Ùˆ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠÙ†.', en: 'The rook moves in straight lines forward, backward, and sideways.'},
    {ar: 'Ø§Ù„ÙÙŠÙ„ ÙŠØªØ­Ø±Ùƒ Ù‚Ø·Ø±ÙŠØ§ Ø¹Ø¨Ø± Ø§Ù„Ù„ÙˆØ­Ø©.', en: 'The bishop moves diagonally across the board.'},
    {ar: 'Ø§Ù„Ù…Ù„ÙƒØ© Ø£Ù‚ÙˆÙ‰ Ù‚Ø·Ø¹Ø©ØŒ ØªØªØ­Ø±Ùƒ ÙÙŠ Ø£ÙŠ Ø§ØªØ¬Ø§Ù‡.', en: 'The queen is the most powerful piece, she moves in any direction.'},
    {ar: 'Ø§Ù„Ù…Ù„Ùƒ ÙŠØ¬Ø¨ Ø­Ù…Ø§ÙŠØªÙ‡. Ø¥Ø°Ø§ ØªØ¹Ø±Ù‘Ø¶ Ø§Ù„Ù…Ù„Ùƒ Ù„Ù„Ø®Ø·Ø± ØªØ¯Ø¹Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø© "ÙƒØ´".', en: 'Protect the king. If the king is under attack, that is called "check".'},
    {ar: 'Ø­Ø§ÙˆÙ„ Ø£Ù† ØªÙ„Ø¹Ø¨ Ø¨Ù‡Ø¯ÙˆØ¡ ÙˆØªÙÙƒØ± Ù‚Ø¨Ù„ ÙƒÙ„ Ù†Ù‚Ù„Ø©. Ø­Ø¸Ù‹Ø§ Ø³Ø¹ÙŠØ¯Ù‹Ø§!', en: 'Try to play calmly and think before each move. Good luck!'}
  ];

  btnAuto.addEventListener('click', async ()=>{
    // Narrate the tutorial in the selected order: AR then EN for each step (educational bilingual)
    for(const step of tutorialSteps){
      // speak in Arabic first to match the user's request (Egyptian)
      const arText = step.ar;
      const enText = step.en;
      // speak arabic
      lang = 'ar'; setActive();
      await speakPromise(arText);
      // short pause
      await delay(600);
      // speak english (american)
      lang = 'en'; setActive();
      await speakPromise(enText);
      await delay(700);
    }
    // return language to user-selected (leave as English if user set it)
  });

  function delay(ms){ return new Promise(res=>setTimeout(res, ms)); }
  function speakPromise(text){
    return new Promise((resolve)=>{
      if(synth.speaking) synth.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = (text && /[\u0600-\u06FF]/.test(text)) ? 'ar-EG' : 'en-US';
      const voices = synth.getVoices();
      const prefer = voices.find(v=> v.lang.toLowerCase().includes(u.lang.toLowerCase()));
      if(prefer) u.voice = prefer;
      u.rate = 0.95;
      u.onend = ()=> resolve();
      u.onerror = ()=> resolve();
      synth.speak(u);
      // fallback resolve in case onend doesn't fire
      setTimeout(()=>resolve(), 7000);
    });
  }

  // ensure voices are loaded in some browsers
  if (speechSynthesis && speechSynthesis.onvoiceschanged !== undefined) {
    speechSynthesis.onvoiceschanged = function(){ /* noop to load voices */ };
  }

  // optional: show a small hint to users about click-to-speak for accessibility
  try{
    const hint = document.createElement('div');
    hint.style.position='fixed';
    hint.style.right='12px';
    hint.style.bottom='12px';
    hint.style.background='rgba(0,0,0,0.6)';
    hint.style.color='#fff';
    hint.style.padding='8px 10px';
    hint.style.borderRadius='8px';
    hint.style.zIndex='9999';
    hint.style.fontSize='13px';
    hint.innerText = 'Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ù†Øµ Ù„Ø³Ù…Ø§Ø¹Ù‡ â€” Click any text to hear it';
    document.body.appendChild(hint);
    setTimeout(()=>hint.remove(), 12000);
  }catch(e){}
})();
</script>
<!-- END: BILINGUAL TTS CONTROLS (injected) -->
</body>
</html>